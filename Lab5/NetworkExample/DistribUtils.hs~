{-# LANGUAGE TemplateHaskell #-}
module DistribUtils ( distribMain ) where

import Control.Distributed.Process
import Control.Distributed.Process.Closure
import Control.Distributed.Process.Node
import Network.Transport.TCP
import Network.Transport
import Data.ByteString.Char8 (pack)
import Control.Distributed.Static hiding (initRemoteTable)

import System.Environment
import Network.Socket hiding (shutdown)

import Language.Haskell.TH

distribMain :: Process () -> IO ()
distribMain process frtable = do
  args <- getArgs
  let rtable = frtable initRemoteTable

  case args of
    [ "master"] -> do
      Right t <- createTransport "127.0.0.1" "44444" defaultTCPParameters
      node <- newLocalNode t rtable
      runProcess node process      

defaultHost = "localhost"
defaultPort = "44444"
